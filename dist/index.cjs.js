"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),v=require("react"),w=require("@auth0/auth0-react"),N=({variant:a="primary",size:e="medium",disabled:s=!1,loading:l=!1,onClick:n,type:r="button",className:i="",children:c})=>{const m="medbai-button",d=`medbai-button--${a}`,h=`medbai-button--${e}`,u=[m,d,h,s?"medbai-button--disabled":"",i].filter(Boolean).join(" ");return t.jsxs("button",{type:r,className:u,disabled:s||l,onClick:n,children:[l&&t.jsx("div",{className:"medbai-spinner medbai-spinner--small"}),c]})},S=({label:a,required:e=!1,error:s,help:l,disabled:n=!1,id:r,children:i,errorId:c,helpId:m})=>{const d=`${r}-label`,h=c||`${r}-error`,g=m||`${r}-help`;return t.jsxs("div",{className:"medbai-form-group",children:[t.jsx("label",{htmlFor:r,id:d,className:`medbai-form-label ${e?"medbai-form-label--required":""}`,children:a}),i,s&&t.jsx("div",{id:h,className:"medbai-form-error",role:"alert","aria-live":"polite",children:s}),l&&!s&&t.jsx("div",{id:g,className:"medbai-form-help",children:l})]})},x=({type:a="text",value:e,onChange:s,placeholder:l,autoComplete:n,maxLength:r,minLength:i,pattern:c,error:m,disabled:d,id:h,...g})=>{const u=["medbai-form-input",m?"medbai-form-input--error":""].filter(Boolean).join(" ");return t.jsx(S,{...g,id:h,error:m,disabled:d,children:t.jsx("input",{id:h,type:a,value:e,onChange:f=>s(f.target.value),placeholder:l,autoComplete:n,maxLength:r,minLength:i,pattern:c,disabled:d,className:u,"aria-invalid":!!m,"aria-describedby":[m?`${h}-error`:"",g.help?`${h}-help`:""].filter(Boolean).join(" ")||void 0})})},L=({type:a="info",message:e,onRetry:s,retryLoading:l=!1,dismissible:n=!1,onDismiss:r,className:i=""})=>{const c=()=>{switch(a){case"info":return"ℹ️";case"warning":return"⚠️";case"error":return"❌";case"success":return"✅";default:return"ℹ️"}};return t.jsx("div",{className:`medbai-status-banner medbai-status-banner--${a} ${i}`,role:"alert",children:t.jsxs("div",{className:"medbai-status-banner-content",children:[t.jsx("span",{className:"medbai-status-banner-icon","aria-hidden":"true",children:c()}),t.jsx("span",{className:"medbai-status-banner-message",children:e}),t.jsxs("div",{className:"medbai-status-banner-actions",children:[s&&t.jsx("button",{onClick:s,disabled:l,className:"medbai-button medbai-button--small medbai-button--secondary","aria-label":"Retry action",children:l?"Retrying...":"Retry"}),n&&r&&t.jsx("button",{onClick:r,className:"medbai-button medbai-button--small medbai-button--secondary","aria-label":"Dismiss message",children:"✕"})]})]})})},A=({data:a,columns:e,emptyMessage:s="No data available",loading:l=!1,sortable:n=!1,onSort:r,className:i=""})=>{const[c,m]=v.useState(null),[d,h]=v.useState("asc"),g=o=>{if(!n)return;const b=c===o&&d==="asc"?"desc":"asc";m(o),h(b),r?.(o,b)},u=v.useMemo(()=>!c||!n?a:[...a].sort((o,b)=>{const p=o[c],y=b[c];if(p===y)return 0;const T=p<y?-1:1;return d==="asc"?T:-T}),[a,c,d,n]),f=(o,b)=>o.render?o.render(b[o.key],b):b[o.key];return l?t.jsx("div",{className:`medbai-table-container ${i}`,children:t.jsxs("div",{className:"medbai-table-empty",children:[t.jsx("div",{className:"medbai-spinner"}),t.jsx("span",{style:{marginLeft:"8px"},children:"Loading..."})]})}):u.length===0?t.jsx("div",{className:`medbai-table-container ${i}`,children:t.jsx("div",{className:"medbai-table-empty",children:s})}):t.jsx("div",{className:`medbai-table-container ${i}`,children:t.jsxs("table",{className:"medbai-table",children:[t.jsx("thead",{children:t.jsx("tr",{children:e.map(o=>t.jsxs("th",{className:`medbai-table-header ${o.sortable?"medbai-table-header--sortable":""} ${o.className||""}`,onClick:()=>o.sortable&&g(String(o.key)),children:[o.label,c===o.key&&t.jsx("span",{style:{marginLeft:"4px"},children:d==="asc"?"↑":"↓"})]},String(o.key)))})}),t.jsx("tbody",{children:u.map((o,b)=>t.jsx("tr",{className:"medbai-table-row",children:e.map(p=>t.jsx("td",{className:`medbai-table-cell ${p.className||""}`,children:f(p,o)},String(p.key)))},b))})]})})};function C(a){return a?a.replace(/[<>]/g,"").replace(/[&"']/g,"").replace(/[/\\]/g,"").trim():""}function P(a){return a?a.replace(/[<>]/g,"").replace(/[&"']/g,"").replace(/[/\\]/g,"").replace(/[^\w\s-]/g,"").trim():""}function k(a){return a?a.replace(/[<>]/g,"").replace(/[&"']/g,"").replace(/[/\\]/g,"").replace(/[^\w\s.-]/g,"").trim():""}function $(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):""}const E=({onSubmit:a,disabled:e=!1,loading:s=!1,className:l=""})=>{const[n,r]=v.useState({name:"",title:""}),[i,c]=v.useState({}),m=()=>{const u={};return n.name&&!n.name.trim()&&(u.name="Name cannot be empty"),c(u),Object.keys(u).length===0},d=u=>{if(u.preventDefault(),!m())return;const f={...n.name&&{name:P(n.name.trim())},...n.title&&{title:k(n.title.trim())}};a(f)},h=u=>f=>{r(o=>({...o,[u]:f})),i[u]&&c(o=>({...o,[u]:void 0}))},g=e||s;return t.jsxs("form",{onSubmit:d,className:`medbai-form ${l}`,children:[t.jsx(x,{id:"name",label:"Name",value:n.name||"",onChange:h("name"),placeholder:"Enter your name (optional if authenticated)",disabled:e||s,error:i.name,help:"Optional - will use authenticated user name if available"}),t.jsx(x,{id:"title",label:"Title",value:n.title||"",onChange:h("title"),placeholder:"Enter your title (optional)",disabled:e||s,help:"Optional title or position"}),t.jsx(N,{type:"submit",disabled:g,loading:s,className:"medbai-button--primary",children:s?"Submitting...":"Submit"})]})},_=({data:a,className:e=""})=>{const s=v.useMemo(()=>[...a].sort((r,i)=>i.count!==r.count?i.count-r.count:r.name.localeCompare(i.name)),[a]),l=r=>{try{return new Date(r).toLocaleString()}catch{return"Invalid date"}},n=[{key:"name",label:"Name",render:(r,i)=>t.jsxs("div",{children:[i.title&&t.jsx("span",{className:"medbai-text-muted",style:{marginRight:"4px"},children:i.title}),t.jsx("span",{className:"medbai-text-primary",children:i.name})]})},{key:"count",label:"Count",render:r=>t.jsx("div",{className:"medbai-text-center",style:{fontWeight:"600",color:"var(--medbai-primary)"},children:r})},{key:"lastHelloAt",label:"Last Hello At",render:r=>t.jsx("div",{className:"medbai-text-muted",style:{fontSize:"var(--medbai-font-size-sm)"},children:l(r)})}];return t.jsx(A,{data:s,columns:n,emptyMessage:"No statistics available yet. Submit a greeting to get started!",className:e})};function H(){if(typeof window>"u")return!1;const a=window.location.origin;return!!(a.startsWith("https://")||a.startsWith("http://localhost")||a.startsWith("http://127.0.0.1"))}const M=({children:a,config:e})=>H()?t.jsx(w.Auth0Provider,{domain:e.domain,clientId:e.clientId,authorizationParams:{redirect_uri:e.redirectUri||window.location.origin+"/callback",audience:e.audience,scope:e.scope||"openid profile email offline_access"},cacheLocation:"localstorage",useRefreshTokens:!0,children:a}):(console.warn("⚠️  Auth0 disabled: App is running on HTTP (non-localhost). Auth0 requires HTTPS or localhost. The app will work without authentication."),t.jsx(t.Fragment,{children:a}));function R(){if(typeof window>"u")return!1;const a=window.location.origin;return a.startsWith("https://")||a.startsWith("http://localhost")||a.startsWith("http://127.0.0.1")}function j(){if(!R())return{isAuthenticated:!1,isLoading:!1,user:void 0,error:void 0,getAccessTokenSilently:async()=>{throw new Error("Auth0 is not available on HTTP (non-localhost). Use HTTPS or localhost.")},getAccessTokenWithPopup:async()=>{throw new Error("Auth0 is not available on HTTP (non-localhost). Use HTTPS or localhost.")},getIdTokenClaims:async()=>{},loginWithRedirect:()=>{console.warn("Auth0 login is not available on HTTP (non-localhost). Use HTTPS or localhost.")},loginWithPopup:async()=>{throw new Error("Auth0 is not available on HTTP (non-localhost). Use HTTPS or localhost.")},logout:()=>{console.warn("Auth0 logout is not available on HTTP (non-localhost). Use HTTPS or localhost.")},handleRedirectCallback:async()=>{throw new Error("Auth0 is not available on HTTP (non-localhost). Use HTTPS or localhost.")}};try{const a=w.useAuth0();return{...a,user:a.user}}catch{return console.warn("Auth0Provider not found, returning mock context"),{isAuthenticated:!1,isLoading:!1,user:void 0,error:void 0,getAccessTokenSilently:async()=>{throw new Error("Auth0Provider is not available")},getAccessTokenWithPopup:async()=>{throw new Error("Auth0Provider is not available")},getIdTokenClaims:async()=>{},loginWithRedirect:()=>{console.warn("Auth0Provider is not available")},loginWithPopup:async()=>{throw new Error("Auth0Provider is not available")},logout:()=>{console.warn("Auth0Provider is not available")},handleRedirectCallback:async()=>{throw new Error("Auth0Provider is not available")}}}}async function D(a){try{return await a()}catch(e){if((e instanceof Error?e.message:String(e)).includes("Missing Refresh Token"))throw console.error("❌ Missing Refresh Token: Please clear your browser storage and log in again. The refresh token is required for silent authentication. This usually happens if you logged in before the offline_access scope was enabled."),new Error("Missing Refresh Token. Please clear your browser storage (localStorage) and log in again to obtain a refresh token.");return console.error("Failed to get access token:",e),null}}const F=()=>{const{isAuthenticated:a,user:e,loginWithRedirect:s,logout:l}=j();if(a&&e){const n=e.name||e.nickname||e.email||"User";return t.jsxs("div",{className:"auth-button",children:[t.jsxs("div",{className:"auth-button__user-info",children:[e.picture&&t.jsx("img",{src:e.picture,alt:n,className:"auth-button__avatar"}),t.jsxs("div",{className:"auth-button__user-details",children:[t.jsx("span",{className:"auth-button__user-name",children:n}),e.email&&t.jsx("span",{className:"auth-button__user-email",children:e.email})]})]}),t.jsx("button",{className:"auth-button__logout",onClick:()=>l({logoutParams:{returnTo:window.location.origin}}),"aria-label":"Logout",children:"Logout"})]})}return t.jsx("button",{className:"auth-button__login",onClick:()=>s(),"aria-label":"Login",children:"Login"})},W=({children:a,fallback:e=null})=>{const{isAuthenticated:s,isLoading:l}=j();return l?t.jsx("div",{children:"Loading..."}):s?t.jsx(t.Fragment,{children:a}):t.jsx(t.Fragment,{children:e})};class z{constructor(e="info",s=!1){this.level=e,this.isDevelopment=s}shouldLog(e){const s={debug:0,info:1,warn:2,error:3};return s[e]>=s[this.level]}formatMessage(e,s,l){const n=new Date().toISOString(),r={level:e,message:s,timestamp:n,context:l};if(this.isDevelopment){const i=e==="debug"?"log":e,c=`[${n}] [${e.toUpperCase()}]`;return console[i](`${c} ${s}`,l||""),s}return JSON.stringify(r)}debug(e,s){this.shouldLog("debug")&&this.formatMessage("debug",e,s)}info(e,s){this.shouldLog("info")&&this.formatMessage("info",e,s)}warn(e,s){this.shouldLog("warn")&&this.formatMessage("warn",e,s)}error(e,s){this.shouldLog("error")&&this.formatMessage("error",e,s)}setLevel(e){this.level=e}}const I=new z(process.env.REACT_APP_LOG_LEVEL||"info",process.env.NODE_ENV==="development");exports.AuthButton=F;exports.AuthProvider=M;exports.Button=N;exports.FormField=S;exports.GreetingForm=E;exports.Input=x;exports.ProtectedRoute=W;exports.StatsTable=_;exports.StatusBanner=L;exports.Table=A;exports.getAccessToken=D;exports.logger=I;exports.sanitizeHTML=$;exports.sanitizeName=P;exports.sanitizeString=C;exports.sanitizeTitle=k;exports.useAuth0=j;
